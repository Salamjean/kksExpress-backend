{
    "info": {
        "_postman_id": "kks-express-v2",
        "name": "KKS Express API - Nouveau Flux",
        "description": "Collection compl√®te avec workflow de livraison r√©aliste (acceptee ‚Üí recuperee ‚Üí en_cours ‚Üí livree)",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "üé´ Auth Utilisateur",
            "item": [
                {
                    "name": "Inscription Utilisateur",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData =pm.response.json();",
                                    "if (jsonData.token) {",
                                    "    pm.environment.set(\"user_token\", jsonData.token);",
                                    "    console.log(\"‚úÖ Token utilisateur sauvegard√©\");",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"nom\": \"Dupont\",\n    \"prenom\": \"Jean\",\n    \"email\": \"jean.dupont@test.com\",\n    \"telephone\": \"+2250708090201\",\n    \"password\": \"password123\",\n    \"adresse\": \"Cocody, Abidjan\",\n    \"ville\": \"Abidjan\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/user/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "user",
                                "register"
                            ]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Connexion Utilisateur",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.token) {",
                                    "    pm.environment.set(\"user_token\", jsonData.token);",
                                    "    console.log(\"‚úÖ Token utilisateur sauvegard√©\");",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"jean.dupont@test.com\",\n    \"password\": \"password123\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/user/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "user",
                                "login"
                            ]
                        }
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "üöö Auth Livreur",
            "item": [
                {
                    "name": "Connexion Livreur",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.token) {",
                                    "    pm.environment.set(\"livreur_token\", jsonData.token);",
                                    "    console.log(\"‚úÖ Token livreur sauvegard√©\");",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"livreur@test.com\",\n    \"password\": \"password123\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/livreur/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "livreur",
                                "login"
                            ]
                        }
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "üì¶ Commandes Utilisateur",
            "item": [
                {
                    "name": "1Ô∏è‚É£ Cr√©er Commande",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "var jsonData = pm.response.json();",
                                    "if (jsonData.commande && jsonData.commande.id) {",
                                    "    pm.environment.set(\"commande_id\", jsonData.commande.id);",
                                    "    pm.environment.set(\"commande_reference\", jsonData.commande.reference);",
                                    "    console.log(\"‚úÖ ID commande sauvegard√©: \" + jsonData.commande.id);",
                                    "    console.log(\"‚úÖ R√©f√©rence: \" + jsonData.commande.reference);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{user_token}}",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"type_colis\": \"Appareils\",\n    \"libelle_colis\": \"Smartphone\",\n    \"nature_colis\": \"fragile\",\n    \"description_colis\": \"iPhone 13 Pro neuf dans sa bo√Æte\",\n    \"expediteur_adresse\": \"Cocody Angr√©, Villa 234, Abidjan\",\n    \"expediteur_latitude\": 5.3600,\n    \"expediteur_longitude\": -4.0100,\n    \"destinataire_nom\": \"Marie Kouassi\",\n    \"destinataire_contact\": \"+2250504030201\",\n    \"destinataire_email\": \"marie.kouassi@test.com\",\n    \"destinataire_adresse\": \"Marcory Zone 4, Rue 12, Abidjan\",\n    \"destinataire_latitude\": 5.3167,\n    \"destinataire_longitude\": -4.0167,\n    \"tarif\": 2500\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/commandes",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "commandes"
                            ]
                        },
                        "description": "‚úÖ Cr√©e une nouvelle commande avec infos destinataire compl√®tes (nom, email, contact)"
                    },
                    "response": []
                },
                {
                    "name": "Suivre Commande (Public)",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/commandes/suivre/:reference",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "commandes",
                                "suivre",
                                ":reference"
                            ],
                            "variable": [
                                {
                                    "key": "reference",
                                    "value": "{{commande_reference}}"
                                }
                            ]
                        },
                        "description": "üåê Tracking GPS en temps r√©el (si statut = en_cours)"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "üöõ Espace Livreur - NOUVEAU FLUX",
            "item": [
                {
                    "name": "Commandes Disponibles",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/disponibles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                "disponibles"
                            ]
                        },
                        "description": "Liste des commandes en_attente (non accept√©es)"
                    },
                    "response": []
                },
                {
                    "name": "2Ô∏è‚É£ Accepter Commande",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/:id/accepter",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                ":id",
                                "accepter"
                            ],
                            "variable": [
                                {
                                    "key": "id",
                                    "value": "{{commande_id}}"
                                }
                            ]
                        },
                        "description": "‚úÖ Statut ‚Üí acceptee | Email: \"Livreur en route pour r√©cup√©rer\""
                    },
                    "response": []
                },
                {
                    "name": "3Ô∏è‚É£ R√©cup√©rer Colis ‚≠ê",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/:id/recuperer",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                ":id",
                                "recuperer"
                            ],
                            "variable": [
                                {
                                    "key": "id",
                                    "value": "{{commande_id}}"
                                }
                            ]
                        },
                        "description": "üì¶ Statut ‚Üí recuperee | üîê G√©n√®re + Envoie code OTP √† l'exp√©diteur ET au destinataire"
                    },
                    "response": []
                },
                {
                    "name": "4Ô∏è‚É£ D√©marrer Livraison ‚≠ê",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/:id/demarrer-livraison",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                ":id",
                                "demarrer-livraison"
                            ],
                            "variable": [
                                {
                                    "key": "id",
                                    "value": "{{commande_id}}"
                                }
                            ]
                        },
                        "description": "üöö Statut ‚Üí en_cours | üìç Active le tracking GPS | Email: \"Livreur en route vers vous\""
                    },
                    "response": []
                },
                {
                    "name": "5Ô∏è‚É£ Mettre √† jour Position",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"latitude\": 5.3300,\n    \"longitude\": -4.0150\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/position",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                "position"
                            ]
                        },
                        "description": "üìç Position mise √† jour SEULEMENT si statut = en_cours"
                    },
                    "response": []
                },
                {
                    "name": "6Ô∏è‚É£ Terminer Livraison (avec OTP)",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"code_confirmation\": \"XXXX\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/:id/terminer",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                ":id",
                                "terminer"
                            ],
                            "variable": [
                                {
                                    "key": "id",
                                    "value": "{{commande_id}}"
                                }
                            ]
                        },
                        "description": "‚úÖ Statut ‚Üí livree | ‚ö†Ô∏è REMPLACER XXXX par le code OTP re√ßu par email | Email: \"Commande livr√©e\""
                    },
                    "response": []
                },
                {
                    "name": "Mes Livraisons Actives",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/mes-livraisons",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                "mes-livraisons"
                            ]
                        },
                        "description": "Liste: acceptee + recuperee + en_cours (max 5)"
                    },
                    "response": []
                },
                {
                    "name": "Historique Livraisons",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{livreur_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/livreur/commandes/historique",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "livreur",
                                "commandes",
                                "historique"
                            ]
                        },
                        "description": "üìä Toutes les livraisons termin√©es + stats"
                    },
                    "response": []
                }
            ]
        }
    ]
}